@let users = usersCache.users;
@let pagination = usersCache.pagination;
@let filter = usersCache.filter;
@let sortOrder = usersCache.sortOrder;

<div class="row">
  <div class="text-center mt-3">
    <h2>Your matches - {{pagination()?.totalCount}}</h2>
  </div>
  <div class="container mt-3">
    <form #form="ngForm" (ngSubmit)="usersService.loadUsers()" class="d-flex mb-3">


      <div class="d-flex mx-2">
        <label class="col-form-label">Age from: </label>
       <input type="number" class="form-control ms-1" style="width: 70px;" name="minAge" [(ngModel)]="filter().minAge">
      </div>
      <div class="d-flex mx-2">
        <label class="col-form-label">Age to: </label>
        <input type="number" class="form-control ms-1" style="width: 70px;" name="maxAge" [(ngModel)]="filter().maxAge">
      </div>
      <div class="d-flex mx-2">
        <label class="col-form-label">Show: </label>
        <select name="gender" style="width: 130px;" class="form-select ms-1" (change)="usersService.loadUsers()" [(ngModel)]="filter().gender">
          @for(gender of (["Male", "Female"]); track $index) {
            <option [value]="gender">
              {{gender}}
            </option>
          }
        </select>
      </div>


      <button class="btn btn-primary ms-1" type="submit">Apply filters</button>
      <button class="btn btn-info ms-1" type="button" (click)="usersService.resetCache()">Reset filters</button>



      <div class="col">
        <div class="btn-group float-end">
          <button type="button" class="btn btn-primary" name="order"
          (click)="usersService.loadUsers()" btnRadio="lastActive" [(ngModel)]="sortOrder">Last active</button>

          <button type="button" class="btn btn-primary" name="order"
          (click)="usersService.loadUsers()" btnRadio="createdAt" [(ngModel)]="sortOrder">Newest users</button>

          <button type="button" class="btn btn-primary" name="order"
          (click)="usersService.loadUsers()" btnRadio="dateOfBirth" [(ngModel)]="sortOrder">Age</button>

          <button type="button" class="btn btn-primary" name="order"
          (click)="usersService.loadUsers()" btnRadio="knownAs" [(ngModel)]="sortOrder">Name</button>
        </div>
      </div>


    </form>
  </div>
  @if(users()) {
  @for (user of users(); track user.id) {
    <div class="col-2">
      <app-user-card [user]="user"></app-user-card>
    </div>
  }
}
</div>
@if(pagination()) {
  <div class="d-flex justify-content-center">
    <pagination [boundaryLinks]="true" [totalItems]="pagination()!.totalCount"
                [itemsPerPage]="pagination()!.current.pageSize" [maxSize]="10"
                (pageChanged)="pageChanged($event)" [(ngModel)]="pagination()!.current.pageNumber"
                previousText="&lsaquo;" nextText="&rsaquo;"
                firstText="&laquo;" lastText="&raquo;"></pagination>
  </div>
}


